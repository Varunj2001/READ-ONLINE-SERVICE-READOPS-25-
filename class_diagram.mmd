classDiagram
    class CustomUser {
        +String username
        +String email
        +String phone
        +JSON books
        +JSON notifications
        +JSON cart
        +Boolean is_librarian
        +take_book(book)
        +return_book(book_id)
        +add_to_cart(book)
        +extend_book(book_id, days)
        +clear_cart()
    }
    
    class Book {
        +String title
        +String description
        +String author
        +Integer quantity
        +String department
        +String subject
        +ImageField image
    }
    
    class Librarian {
        +CustomUser user
    }
    
    class UserQRCode {
        +CustomUser user
        +String qr_code_data
        +ImageField qr_code_image
        +Boolean is_active
        +DateTime created_date
        +DateTime updated_date
        +generate_qr_data()
    }
    
    class Payment {
        +CustomUser user
        +Book book
        +String book_title
        +Decimal amount
        +String payment_type
        +String payment_method
        +String bank_name
        +DateTime payment_date
    }
    
    class Fine {
        +CustomUser user
        +String book_title
        +Integer book_id
        +DateTime due_date
        +Decimal amount
        +Integer days_overdue
        +String status
        +DateTime created_date
        +DateTime last_updated
        +calculate_fine()
    }
    
    class QRScanLog {
        +CustomUser scanned_user
        +CustomUser scanned_by
        +String scan_type
        +DateTime scan_timestamp
        +String location
        +String notes
        +String ip_address
        +String user_agent
        +scan_date()
        +scan_time()
    }
    
    class DigitalBook {
        +String title
        +String author
        +String description
        +String book_type
        +String category
        +ImageField cover_image
        +FileField pdf_file
        +FileField word_file
        +Decimal online_reading_price
        +Decimal download_price
        +Boolean is_free
        +Boolean is_active
        +DateTime created_date
        +DateTime updated_date
    }
    
    class DigitalBookAccess {
        +CustomUser user
        +DigitalBook digital_book
        +String access_type
        +String status
        +Decimal payment_amount
        +DateTime access_start_date
        +DateTime access_end_date
        +String payment_reference
        +String qr_code
        +DateTime created_date
        +is_access_valid()
    }
    
    class QRPayment {
        +CustomUser user
        +DigitalBookAccess digital_book_access
        +Decimal amount
        +String qr_code_data
        +ImageField qr_code_image
        +String status
        +String payment_reference
        +DateTime created_date
        +DateTime expires_at
        +is_expired()
    }
    
    class MobileNotification {
        +CustomUser user
        +String bima_id
        +String notification_type
        +String title
        +String message
        +String book_title
        +Integer book_id
        +String status
        +DateTime created_date
        +DateTime expires_at
        +DateTime response_date
        +generate_bima_id()
        +is_expired()
    }
    
    %% Relationships
    CustomUser ||--o{ Payment : "makes"
    CustomUser ||--o{ Fine : "has"
    CustomUser ||--o{ MobileNotification : "receives"
    CustomUser ||--o{ DigitalBookAccess : "has access to"
    CustomUser ||--o{ QRPayment : "makes"
    CustomUser ||--o{ QRScanLog : "scanned"
    CustomUser ||--o{ QRScanLog : "scanned by"
    CustomUser ||--|| UserQRCode : "has"
    CustomUser ||--|| Librarian : "can be"
    
    Book ||--o{ Payment : "paid for"
    Book ||--o{ Fine : "subject of"
    
    DigitalBook ||--o{ DigitalBookAccess : "accessed through"
    
    DigitalBookAccess ||--|| QRPayment : "paid via"
    
    %% Styling
    classDef userClass fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef bookClass fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef paymentClass fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef digitalClass fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef notificationClass fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef qrClass fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    
    class CustomUser,Librarian userClass
    class Book bookClass
    class Payment,Fine paymentClass
    class DigitalBook,DigitalBookAccess digitalClass
    class MobileNotification notificationClass
    class UserQRCode,QRPayment,QRScanLog qrClass
